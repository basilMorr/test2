<script>
    console.log('Script loaded. Initializing Lottie animation.');

    // Load the Lottie animation JSON file
    const lottieAnimation = lottie.loadAnimation({
        container: document.getElementById('lottie-container'),
        renderer: 'svg',
        loop: false,
        autoplay: false,
        path: 'data.json' // Path to your Lottie JSON file
    });

    // Function to adjust the width of the menu bar to match the Lottie animation
    function adjustMenuBarWidth() {
        const lottieElement = document.querySelector('#lottie-container svg');
        const menuBar = document.getElementById('menu-bar');

        if (lottieElement) {
            const lottieWidth = lottieElement.getBoundingClientRect().width;
            console.log(`Lottie Element Width: ${lottieWidth}`);

            // Adjust menu bar width and force redraw
            menuBar.style.width = `${lottieWidth}px`;
            menuBar.style.transform = 'scale(1.01)'; // Apply temporary transform
            requestAnimationFrame(() => {
                menuBar.style.transform = ''; // Reset transform
            });

            console.log(`Adjusted Menu Bar Width to: ${lottieWidth}`);
        } else {
            console.error('Lottie SVG element not found. Retrying...');
        }
    }

    // Use ResizeObserver to monitor changes in the Lottie element's size
    const resizeObserver = new ResizeObserver(entries => {
        for (let entry of entries) {
            if (entry.target.matches('#lottie-container svg')) {
                console.log('ResizeObserver triggered for Lottie element.');
                adjustMenuBarWidth(); // Adjust when the Lottie element resizes
            }
        }
    });

    // Wait for the Lottie animation to load and then start observing
    lottieAnimation.addEventListener('DOMLoaded', () => {
        console.log('Lottie animation DOM loaded.');
        const lottieElement = document.querySelector('#lottie-container svg');

        if (lottieElement) {
            console.log('Starting observation of Lottie element.');
            resizeObserver.observe(lottieElement); // Start observing the Lottie element
            adjustMenuBarWidth(); // Initial adjustment
        } else {
            console.error('Lottie SVG element not found after DOMLoaded.');
        }
    });

    // Continuous monitoring to ensure that the menu bar stays synchronized
    function monitorAnimation() {
        adjustMenuBarWidth();
        requestAnimationFrame(monitorAnimation); // Continuously monitor the Lottie element width
    }

    // Start the monitoring process when the Lottie animation is loaded
    lottieAnimation.addEventListener('DOMLoaded', () => {
        console.log('Starting continuous monitoring of animation.');
        monitorAnimation();
    });

    // Bind the animation playback to the scroll event
    window.addEventListener('scroll', () => {
        console.log('Scroll event detected.');
        if (lottieAnimation.totalFrames > 0) {
            const scrollTop = window.scrollY || window.pageYOffset;
            const maxScrollTop = document.documentElement.scrollHeight - window.innerHeight;
            const scrollFraction = scrollTop / maxScrollTop;
            const frame = Math.min(
                lottieAnimation.totalFrames * scrollFraction,
                lottieAnimation.totalFrames - 1
            );
            console.log(`Scroll position: ${scrollTop}, Frame: ${frame}`);
            lottieAnimation.goToAndStop(frame, true);
        } else {
            console.error('Animation frames are not available yet or set to zero.');
        }
    });
</script>
